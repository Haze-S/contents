---
date: '2024-05-01'
title: 'Vite 사용한 이유'
categories: ['Note']
tags: ['React', 'Project', 'Rolling']
thumbnail: 'https://github.com/Haze-S/blog-contents/assets/87344625/2144463c-7032-43aa-8b6b-28d62b6d2954'
---

# CRA vs Vite

이번 프로젝트는 이전에 배운 리액트를 직접 활용해보는 프로젝트였다. 번들러는 여러가지가 존재하고 강의에서는 Vite를 사용하지 않고 리액트 공식 문서에 나오는 CRA를 사용했지만, 우리는 아래와 같은 이유로 Vite를 택했다.

### 번들러(Bundler)

각 도구의 특징과 장단점을 비교하기 전에 둘의 가장 큰 차이점있다. 이는 각 도구에서 사용하는 번들러였는데, 번들러가 무엇인 지 간략하게 정리하자면 아래와 같다.

자바스크립트를 이용해 단순한 상호작용만 하던 과거와는 달리 현 시대의 웹 사이트는 많은 기능과 다양한 이벤트를 가지고 있다. 사용자의 니즈에 따라 화려한 사이트를 만들기 위해서는 코드의 양이 많아지고 애플리케이션의 크기가 커질 수 밖에 없다. 개발자들은 많아진 코드의 에러 가능성을 낮추고, 재사용성을 높이고, 유지보수를 쉽게 하기위해 코드들을 모듈화하기 시작했다. 시간이 흘러 다양한 프레임워크와 파일들이 점점 많아졌고, 많아진 모듈들을 하나로 묶는 과정은 어려워졌다.

모듈 시스템이 표준화 되기 전에 여러 `.js` 파일들은 HTML의 `<script>` 태그로 연결하는 방식이 사용됐다. 이는 전역 오염이나 의존성 관리에 어려움을 주는 등 다양한 문제가 발생했다. 그래서 CommonJs, AMD, UMD 등의 모듈 시스템이 등장했고, 이런 모듈 시스템을 브라우저에서 효율적으로 사용하기 위해 번들러가 등장했다.

![번들이미지](https://github.com/Haze-S/blog-contents/assets/87344625/7d387432-8bce-4944-94dd-786217f9fdc0)

번들러는 웹앱을 개발하기 위해 필요한, 그리고 모듈화된 자원들을 모아 하나 혹은 최적의 소수 파일로 결합하는 도구이다.
결합을 위해 불필요한 주석이나 공백 제거, 난독화, 파일 압축 등의 기본적인 작업을 수행하고 최신 문법이나 기타 특수 기능 등을 각각의 브라우저가 지원하는 형태로 변환하는 작업을 수행한다. 또한 모듈들의 의존 관계를 분석하여 브라우저가 인식할 수 있는 코드로 변환해준다.

## CRA(Create-React-App)

CRA는 리액트 공식 홈페이지에서 알려주는 싱글페이지 프로젝트를 빌드하는 도구이다. CRA는 웹 사이트의 내부에서 동작하는 Babel, Webpack과 같은 패키지를 사전에 구성하여 함께 제공된다. 따라서 개발자가 따로 개발 환경을 설정할 필요가 없어 초기 설정이 매우 쉽다.
CRA의 특징으로는 아래와 같다.

- 자바스크립트로 구성된 번들러인 [webpack](https://webpack.kr/)을 사용한다.
  - webpack은 자바스크립트로 구성된 툴이다.
  - 자바스크립트는 인터프리터 언어이기 때문에 처리해야 할 코드의 양이 방대할 경우 느리다는 단점이 명확히 느껴진다.
  - 개발 서버를 시작할 때 모든 모듈을 한 번에 변환한다.
- React 외에 Vue와 같은 다른 기술을 사용하려면 추가 설정이 필요하다.
- 설정이 미리 구성되어 있어 편리하지만, 사용자 정의 설정을 추가하려면 eject 과정을 거쳐야 한다.

### CRA을 배제한 이유

1. **느린 속도**
   CRA는 webpack을 이용하기 때문에 프로젝트에 모듈과 종속성이 많은 경우 이를 제공하는데 많은 시간이 소요된다. 번들링의 속도가 느려 빌드 또한 따라서 느려진다.

2. **설정 구성**
   프로젝트 초기 설정을 구성할 때 사용되지 않을 프로젝트도 빌드 툴 안에 미리 구성되어 있어 이를 수정하기 위해선 추가적인 과정이 필요하다.

3. **런처 형태로의 변경**
   2023년 1월, 리액트 팀은 깃허브에서 CRA는 미래에 더 이상 리액트 앱을 만드는 보일러 플레이트 CLI가 아니라 여러 리액트 기반 프레임워크를 제안하는 런처 형태로 변경될 예정이라고 밝혔다.

## Vite

CRA와 마찬가지로 빌드 도구이며 처음에는 Vue를 위해 만들어졌으나 지금은 React와 같은 다른 기술들도 지원이 가능하다. Vite는 개발 환경에서 HMR과 같은 기능을 제공하는 개발용 서버 기능과 Production 배포를 위한 소스코드 번들링 기능을 한다.
Vite의 특징으로는 아래와 같다.

- 번들링 작업은 [esbuild](https://esbuild.github.io/)를 통해 이루어진다.
- Dependencies와 SourceCode를 분리하여 빌드한다.
  - Dependencies는 개발하는 동안 변화가 거의 없는 의존성 모듈들이고 SourceCode는 작성중인 코드로서 변화가 잦다.
  - Vite는 esbuild를 이용해서 미리 트랜스파일링 한 뒤, 개발 서버에서 Native ESM을 이용해서 소스 코드를 불러오면서 의존성이 있는 패키지만 가져온다.
  - 이전에 빌드한 결과는 캐싱을 해 다음 빌드에 바로 띄우게 한다.
- 프로덕션 빌드 시 Rollup을 사용하여 코드를 최적화한다.
  - Rollup은 코드를 효과적으로 트리쉐이킹 하여 불필요한 코드를 제거하고, 결과물의 파일 크기를 최소화 한다.
- 기존 ES Module보다 매우 빠른 Hot Module Replacement를 제공한다.
- TS, CSS로더, HMR을 제공하면서도 복잡한 설정이 필요없다.

### Vite의 장점

Vite는 esbuild를 기반으로 만들어진 빌드 툴이다. esbuild는 Go 언어로 작성된 자바스크립트 빌드 툴로 빠른 속도가 장점이다.

![esbuild](https://github.com/Haze-S/blog-contents/assets/87344625/61be0637-3553-409e-97a3-e74626a8c68a)

Webpack이 브라우저의 요청 이전에 모든 자바스크립트 모듈을 처리하는 반면, esbuild를 이용한 Vite는 브라우저 요청 전에 의존성 모듈만 미리 번들링한다. 따라서 빌드 속도가 CRA에 비해서 매우 빠르다.

또한 Vite는 ES 모듈을 사용하여 브라우저가 필요로하는 코드의 일부분만 변환하고 제공한다.

![nativeESM](https://github.com/Haze-S/blog-contents/assets/87344625/be3a28d8-b957-425d-9aec-aa8b2720f793)

HMR은 나머지 페이지에 영향을 끼치지 않고, 특정 모듈만 "즉시 반영" 될 수 있도록 해준다. 하지만 프로젝트의 크기가 커질 수록, HMR의 시간 또한 길어지게 되므로 이는 생산성 저하로 이어지게 되는데, Vite는 네이티브 ESM을 기반으로 HMR을 구현한다. 모듈이 수정되면, Vite는 수정된 모듈과 관련된 부분만을 교체할 뿐이고, 브라우저에서 해당 모듈을 요청하면 교체된 모듈을 전달할 뿐이다. 이는 어플리케이션의 크기와 관계 없이 HMR을 언제든 빠르게 이뤄지도록 한다.

따라서 Vite는 esbuild를 이용한 사전번들링과 Native ESM 기반의 Dev Server로 인해 서버 구동속도와 HMR 속도가 엄청나게 빨라졌다.

추가로 프로젝트 생성 시 초기 설정을 자동으로 처리하지만 추가적인 설정이나 필요하지 않은 설정을 삭제할 때 보다 더 쉽게 설정할 수 있다.

### Vite도 단점은 있다.

아직 ESM을 프로덕션에 배포하는 것은 비효율적인 부분이 있기 때문에 배포를 위해서는 기존 번들 과정이 필요하다. 또한 트리쉐이킹이나 코드 스플리팅과 같은 최적화 기능을 제공하지 않는다. 따라서 기존의 번들링 기법을 최대한 활용하게 되고 내부적으로는 Rollup을 사용하고 있다. 그리고 아직은 SSR 지원 폭이 좁고 안정성이 떨어진다.

Vite가 빠르고 편리하다는 장점은 있지만 단점이 아예 없는 빌드 도구는 아니다. 또한 CRA는 Vite보다 속도는 느릴지언정 보다 더 활성화된 webpack을 사용하고 리액트를 기반으로 만들어진 툴이라 초기 설정이 쉽다. 어떤 도구를 사용하든 개발 환경과 프로젝트의 성격에 따라 도구를 결정하는 것이 맞는 것 같다.

---

#### ref.

[Vite 가이드](https://ko.vitejs.dev/guide/)
[[Vue + Vite] 근데 Vite는 뭔가요?](https://analogcode.tistory.com/39)
[Bonjour, Vite! (Vite 실무 적용기)](https://blog.hectodata.co.kr/bonjour-vite/)
[[Bundler] JavaScript 번들러 그리고 Webpack , Parcel , Rollup , Vite...](https://velog.io/@wynter_j/Bundler-JavaScript-%EB%B2%88%EB%93%A4%EB%9F%AC-%EA%B7%B8%EB%A6%AC%EA%B3%A0-Webpack-Parcel-Rollup-Vite...-1)
[번들러와 빌드 도구의 이해](https://www.heropy.dev/p/x8iedW)
